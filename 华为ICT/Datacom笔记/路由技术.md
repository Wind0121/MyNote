# 路由概述
## 路由基本概念
路由就是指导报文转发的路径信息，通过路由可以确认转发IP报文的路径。

![[Pasted image 20231023093047.png]]
## 路由条目生成
![[Pasted image 20231023093119.png]]
三种方式，先简单说说直连路由：
- 直连路由指向本地直连网络的路由，由设备自动生成
- 当路由器为路由转发的最后一跳路由器时，IP报文匹配直连路由，路由器转发IP报文到目的主机
- 使用直连路由进行路由转发时，报文的目的IP和路由器接口IP在一个网段之中。

## 最优路由条目选择
![[Pasted image 20231023093312.png]]
路由优先级数值越低，优先级就越高。一般定义优先级数值的方式有：
1. 默认数值：直连优先级为0，静态路由优先级为60，OSPF内部路由为10，OSPF外部路由为150
2. 依靠度量值：可以依靠Cost（开销）来进行判断，Cost越小，Pre越小，优先级越高。

## 路由转发
![[Pasted image 20231023093555.png]]

# 静态路由
静态路由由管理员进行配置，最常见的静态路由就是缺省路由：
![[Pasted image 20231023093731.png]]
通常缺省路由用于企业网络出口，配置一条缺省路由让出口设备能够转发前往Internet上任意地址的IP报文。

# 动态路由
![[Pasted image 20231023094000.png]]

## RIP
可以直接看计网部分，RIP已经逐步被OSPF和IS-IS替代了。

## OSPF
![[Pasted image 20231023103312.png]]

|路由器类型|含义|
|---|---|
|区域内路由器（Internal Router）|该类设备的所有接口都属于同一个OSPF区域。|
|区域边界路由器ABR（Area Border Router）|该类设备可以同时属于两个以上的区域，但其中一个必须是骨干区域。<br><br>ABR用来连接骨干区域和非骨干区域，它与骨干区域之间既可以是物理连接，也可以是逻辑上的连接。|
|骨干路由器（Backbone Router）|该类设备至少有一个接口属于骨干区域。<br><br>所有的ABR和位于Area0的内部设备都是骨干路由器。|
|自治系统边界路由器ASBR（AS Boundary Router）|与其他AS交换路由信息的设备称为ASBR。<br><br>ASBR并不一定位于AS的边界，它可能是区域内设备，也可能是ABR。只要一台OSPF设备引入了外部路由的信息，它就成为ASBR。|

![[Pasted image 20231023102656.png]]
更多的也去计网部分看

## IS-IS
IS-IS与[OSPF](https://info.support.huawei.com/info-finder/encyclopedia/zh/OSPF.html "OSPF")的区别如下：
- 协议类型：OSPF使用IP层协议。IS-IS使用链路层协议。
- 协议扩展性：OSPF通过扩展LSA type应对新的需求，扩展性一般。比如对[IPv6](https://info.support.huawei.com/info-finder/encyclopedia/zh/IPv6%2B.html "IPv6+")的支持，需要新的OSPFv3协议来支持。IS-IS由于本身TLV的报文结构，决定了其超强的扩展性。比如对IPv6的支持，仅需扩展TLV。
- 适用范围：OSPF应用于规模适中的网络中，最多可支持几百台设备。例如，中小型企业网络。IS-IS应用于规模较大的网络中。例如，大型ISP（Internet Service Provider）中。
- 路由算法：OSPF采用最短路径SPF（Shortest Path First）算法。通过链路状态通告LSA（Link State Advertisement）描述网络拓扑，依据网络拓扑生成一棵最短路径树SPT（Shortest Path Tree），计算出到网络中所有目的地的最短路径。IS-IS采用最短路径SPF算法。依据网络拓扑生成一棵最短路径树SPT，计算出到网络中所有目的地的最短路径。在IS-IS中，SPF算法分别独立的在Level-1和Level-2数据库中运行。
- 收敛速度：OSPF与IS-IS收敛速度都比较快，小于1s。
- 区域划分：OSPF是基于接口划分区域的，IS-IS是基于路由器划分区域的。

![[Pasted image 20231023104609.png]]
- Level-1路由器
    Level-1路由器负责区域内的路由，它只与属于同一区域的Level-1和Level-1-2路由器形成邻居关系。一个Level-1路由器只负责维护本区域内的LSDB（Link State Database，链路状态数据库），对于目的地不在本区域内的路由，Level-1路由器会将该路由的目的地标识为最近的Level-1-2路由器。
- Level-2路由器
    Level-2路由器负责区域间的路由，可以与Level-2或其它区域的Level-1-2路由器形成邻居关系，维护一个Level-2的LSDB，该LSDB包含区域间的路由信息。
    
    所有Level-2级别的路由器组成路由域的骨干网，负责在不同区域间通信，路由域中Level-2级别的路由器必须是连续的，以保证骨干网的连续性。只有Level-2级别的路由器才能直接与区域外的路由器交换数据报文或路由信息。
- Level-1-2路由器
    同时属于Level-1和Level-2的路由器称为Level-1-2路由器，可以与同一区域的Level-1和Level-1-2路由器形成Level-1邻居关系，也可以与其他区域的Level-2和Level-1-2路由器形成Level-2的邻居关系。Level-1路由器必须通过Level-1-2路由器才能连接至其他区域。
    
    Level-1-2路由器维护两个LSDB，Level-1的LSDB用于区域内路由，Level-2的LSDB用于区域间路由。

## BGP
直接看计网部分吧

# 路由高级特性
## 路由递归
![[Pasted image 20231023112151.png]]
去往30.1.2.0/24的路由，下一跳为20.1.1.3，非本地直连网络，如果路由表中没有去往20.1.1.3的路由，该静态路由将不会生效，无法作为有效路由条目，并不会出现在路由表。

因而在路由表上添加20.1.1.3的直连网络路由条目，这样就可以递归查找
（这地方虽然出接口已经定义了，但如果下一跳IP地址不存在，也不行）

## 等价路由
![[Pasted image 20231023112347.png]]

## 浮动路由
![[Pasted image 20231023112406.png]]
两条路由表项有不同的优先级，则先使用优先级值低的项，不能用的时候再转向另一个。

## 路由汇总
就是将相同前缀的路由汇聚为一个路由表项

# OSPF基础
以下是OSPF协议的大致流程：
![[Pasted image 20231025094707.png]]

## OSPF术语
**区域**
- OSPF Area用于标识一个OSPF的区域。
- 区域是从逻辑上将设备划分为不同的组，每个组用区域号（Area ID）来标识。

**Router ID**
Router-ID（Router Identifier，路由器标识符），用于在一个OSPF域中唯一地标识一台路由器

**度量值**
OSPF使用Cost（开销）作为路由的度量值。每一个激活了OSPF的接口都会维护一个接口Cost值，缺省时接口Cost值=$100 Mbit/s 接口带宽 。其中100 Mbit/s为OSPF指定的缺省参考值，该值是可配置的。
