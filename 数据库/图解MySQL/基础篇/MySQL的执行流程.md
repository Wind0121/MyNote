![[Pasted image 20231220111428.png]]
MySQL的架构分为两层：Server层和存储引擎层。
- Server层负责将SQL语句转化为抽象语法树，然后再转化为计划树（Planner Tree），最后经过优化器和执行器生成对应的执行树（Executor Tree）
- 存储引擎层负责提供API接口给执行器，供执行器实现各种功能。

# 连接器
连接器负责将客户端连接到MySQL服务器：
- 需要“用户名”和“密码”，验证正确后连接器会获取该用户的权限
- MySQL的连接数有最大限制
- MySQL定义了空闲连接的最大空闲时间，超过就会断开连接。如果此时客户端再次发出SQL语句，就会被告知连接已丢失
- MySQL采用TCP连接，支持短连接和长连接。短连接就是每发出一条SQL语句就断开TCP服务，长连接则是一直保持TCP连接。一般都采用长连接。

# 查询缓存
这是一个Server层的Cache，如果之前执行过这个SQL语句，就会直接返回结果。

由于每次更新一个表都会清空该表在查询缓存中的记录，因而查询缓存的命中率并不高。

MySQL 8.0直接取消了查询缓存

# 解析SQL
![[Pasted image 20231220112611.png]]
此处建议搭配这张图观看
- Parser：编译器。负责进行词法分析和语法分析，将SQL语句转化成抽象语法树（AST），确保SQL语法正确。
- Binder：绑定器。将语法树和数据库的元数据结合，从而生成有语义的抽象语法树（bound AST）。这个期间会检查表是否存在。
- 经过这两个步骤，SQL语句就算是解析完毕了。

# 执行SQL
- Planner：根据给定的语法树，Planner会先生成一个**逻辑执行树(logical operator tree)**。这个过程通常是语法树节点到操作符节点一对一生成。
- Optimizer：优化器负责将逻辑逻辑执行树进行进一步优化。
- Executor：执行器负责将逻辑执行树转化为物理执行树，也就是对应的Executor，这样SQL语句就得到了执行。


