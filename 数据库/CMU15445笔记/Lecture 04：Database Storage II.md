# 引言
在上节课中，我们谈到了利用带槽页面进行存储数据管理的方法，在这种方法中，insert和update的流程如下：
![[Pasted image 20231031190850.png]]

事实上这种方法已经有点过时了，有着多次访问磁盘的坏处、以及大量随机访问的问题。今天我们将讲述日记结构的存储方式，如下：
![[Pasted image 20231031191332.png]]

# 日志结构存储
![[Pasted image 20231031193911.png]]
- 每个日志包含元组的id
- 每个日志都包含元组的所有内容，所以是put操作
- 删除操作只负责标记元组已被删除

**日志查找**
![[Pasted image 20231031194008.png]]
我们将设计一个map，key是tuple的id，value是该tuple的最新日志。这个日志可能还在内存中，也可能已经存进了磁盘，总之我们都可以快速定位。

**日志压缩**
![[Pasted image 20231031194136.png]]
我们不能任由日志数量增长，而且日志都只需要覆盖的，我们只需要保留所有日志的最新版本即可，并且不用管时间顺序。

# tuple storage（元组存储）
**浮点数表示**
说实话这个真的很无趣

**大数据存储**
![[Pasted image 20231031202223.png]]
大多数数据库都不允许一个元组的大小超出一个页面的大小。

为了保存大于一个页面的单个数据，数据库系统会使用单独的溢出页来进行存储。

![[Pasted image 20231031202325.png]]
有些数据库系统可能还会用外链的形式，即tuple中只存储url，这个URL指向一个外部文件。


