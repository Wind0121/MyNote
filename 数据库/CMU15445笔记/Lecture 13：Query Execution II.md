# 并行执行
在实践中，查询往往是与多个 worker 并行执行的。并行能提供多个好处：
- 吞吐量和延迟方面的性能提升
- 潜在地降低总拥有成本(TCO)
- 增加了响应性和可用性
- DBMS 支持两种类型的并行性：查询间并行和查询内并行

# 并行数据库和分布式数据库
在并行和分布式系统中，数据库都分散在多个“资源”上，以提高并行性。两者区别：
- 在并行 DBMS 中，资源或节点在物理上彼此接近。这些节点通过高速互连进行通信。
- 在分布式 DBMS 中，资源可能彼此相距很远。资源在公共网络上使用较慢的互连进行通 信

# Process Models
- 进程模型定义了系统如何支持来自多用户应用程序/环境的并发请求。
- Worker 是 DBMS 组件，负责代表客户端执行任务并返回结果

## Process per Worker
每个 worker 都是一个独立的 OS 进程，因此依赖于 OS 调度器。执行流程如下：
- 一个应用程序发送一个请求，并打开到数据库系统的连接
- 分配器接收到请求后，选择它的一个工作进程（worker）来管理连接
- 应用程序直接与负责执行查询所需请求的工作进程进行通信

![[Pasted image 20231205152943.png]]

## Thread per Worker
每个数据库系统只有一个具有多个工作线程的进程。DBMS 完全控制任务和线程，它可以管理自己线程的调度。
![[Pasted image 20231205153105.png]]

## Embedded DBMS
数据库的一种非常不同的使用模式是在应用程序的相同地址空间中运行系统。在这种情况下，应用程序将设置在数据库系统上运行的线程和任务
![[Pasted image 20231205153322.png]]

## 调度
对于每个查询计划，DBMS 必须决定在何处、何时以及如何执行。相关的问题包括：
- How many tasks should it use?
- How many CPU cores should it use?
- What CPU core should the tasks execute on?
- Where should a task store its output?

# Inter-Query Parallelism（查询间并行）
- 在查询间并行中，DBMS 并发地执行不同的查询
- 因为多个 worker 同时运行请求，所以整体性能得到了提高
- 增加了吞吐量，减少了延迟

如果查询是只读的，那么查询之间几乎不需要协调。然而，如果多个查询同时更新数据库，则会出现更复杂的冲突。这些问题将在**第 15 讲**中进一步讨论

# Intra-Query parallelism（查询内并行）
在查询内并行中，DBMS 并行地执行单个查询的操作。这减少了长时间运行的查询的延迟。

## Intra-Operator Parallelism (Horizontal)
在操作符内部并行中，查询计划的操作符被分解为独立的片段，在不同的(不相交的)数据子集上执行相同的功能。

三种常见的操作符内部并行：
![[Pasted image 20231205155600.png]]
1. 汇总：将多个worker的结果合并输出
2. 分发：将单个输入流分发给多个worker
3. 重新分配：将多个输入流重新组织成多个输出流

## Inter-Operator Parallelism (Vertical)
在操作符间并行性中，DBMS为执行计划垂直方向的每个操作符都分配线程，从而实现流水线并行。
![[Pasted image 20231205160052.png]]
这样做可能存在的问题是，垂直方向两个操作符的输入输出速度不匹配，就会出现等待停滞的问题。

## Bushy Parallelism
Bushy parallelism 是操作符内并行和操作符间并行的混合。例子如下：
![[Pasted image 20231205160456.png]]

# I/O Parallelism
如果磁盘始终是主要瓶颈，使用额外的进程/线程并行执行查询不会提高性能。因此，能够跨多个存储设备拆分数据库是很重要的。

## Multi-Disk Parallelism
在 多磁盘并行中， 操作系统/硬件被配置为跨多个存储设备存储 DBMS 文件。这种配置对DBMS是透明的，即DBMS不会感知底层的并行性。

## Database Partitioning
在数据库分区中，数据库被划分为不相交的子集，这些子集可以分配给离散的磁盘
- 在垂直分区中，表的属性被存储在一个单独的位置(就像列存储)
- 在水平分区中，表的元组根据一些分区键被划分为不相交的段。

>我们将在讨论分布式数据库时介绍这些方 法


