# 引论和服务
## 一些术语
- nodes：主机、路由器、交换机、网桥都称为节点
- links：沿着通信路径，连接个相邻节点通信信道的是链路
- frame：协议数据单元帧，用于封装数据报

## 链路层服务例子
![[Pasted image 20231015094315.png]]

## 链路层服务
![[Pasted image 20231015095106.png]]
![[Pasted image 20231015095116.png]]
![[Pasted image 20231015095126.png]]

## 链路层在哪实现
![[Pasted image 20231015100527.png]]
![[Pasted image 20231015100845.png]]
网卡中的物理层功能将帧中的每一个比特转变为物理信号发送出去。

# 差错检测和纠正
感觉不是重点，没必要听了。

# 多点访问协议
广域网通常采用点对点的链路，也就不存在多点访问控制的问题。

局域网则有多点访问的情况，如果2个或更多站点同时传送，就会产生冲突（collision），多个信号叠加最终导致信号不可用。因而需要用到多路访问协议（介质访问控制协议：MAC ）

MAC解决的就是节点什么时候可以发送、如何使用共享信道。

## 理想的多路访问协议
 1. 当一个节点要发送时，可以R速率发送
 2. 当M个节点要发送，每个可以以R/M的平均速 率发送 
 3. 完全分布的：没有特殊节点协调发送，没有时钟和时隙的同步 
 4. 简单

## 信道划分MAC协议：TDMA
![[Pasted image 20231015105709.png]]
每个节点都占用固定的时隙，无论有没有帧需要传输，周期中都会进行保留

## 信道划分MAC协议：FDMA
![[Pasted image 20231015105825.png]]
和时分复用一样，都存在空闲的问题。

## 信道划分MAC协议：CDMA
![[Pasted image 20231015110136.png]]
3G使用的技术，因而已经是过时了的

## 随机存取MAC协议
当节点有帧要发送时：
- 以信道带宽的全部 R bps发送
- 没有节点间的预先协调

两个节点发生冲突时，就会做出以下操作：
- 检测冲突
- 从冲突中恢复

## 随机存取MAC协议：时隙ALOHA
![[Pasted image 20231015112342.png]]
很显然，概率上没法保证节点最终传输成功的上限

这里是一个例子：
1. 三个节点冲突
2. 三个节点都决定不发
3. 1、2节点决定发，冲突
4. 只有2节点决定发，成功
5. 1、3节点都决定不发
6. 1、3节点都决定发，冲突
7. 1、3节点都决定不发
8. 1节点决定发，成功
9. 3节点决定发，成功
![[Pasted image 20231015112945.png]]
这里需要与信道划分的TDMA进行区分，TDMA将时间进行划分，相当于所有节点在一秒内共享发送，那么获得的发送速率就是划分后的速率。而这里使用的是时隙，是在这个时隙中占用整个带宽，因而可以全速传输。

缺点中的必须传完：节点冲突时还是会将帧全部传完，这就导致了信道的浪费

![[Pasted image 20231015114452.png]]
这个计算过程比较简单

## 随机存取MAC协议：纯ALOHA
![[Pasted image 20231015120139.png]]
相比于时隙ALOHA的同步时间情况，这样更容易发生碰撞。
![[Pasted image 20231015120150.png]]

## 随机存取MAC协议： CSMA(载波侦听多路访问)
![[Pasted image 20231016082407.png]]

这样做仍然可能产生冲突，且看下图：横轴是空间，纵轴是时间。两个节点之间存在传播延迟，导致节点侦听时，帧还没有传输到这里，也就误认为信道是空闲的。

因而传播延迟越大，冲突的概率也就越大（越难侦听）
![[Pasted image 20231016083204.png]]

## 随机存取MAC协议： CSMA/CD(冲突检测)
![[Pasted image 20231016083722.png]]
CSMA的改进版：
- 主要用于有线局域网
- 通过检测冲突，及时停止发送，从而减少信道浪费

可以这么看这张图，随着纵轴时间推移，两个节点都向外发送数据，在对方数据到达后，侦听一段时间，确认是冲突后，便两个节点都停止发送，从而减少信道浪费。对比之下，之前的纯CSMA是要发送完整个数据的。
![[Pasted image 20231016083822.png]]


实际中的算法还有第四步，在停止发送时，还要发送一个Jam（增强信号），让所有听到适配器知道当前正在冲突。

这张ppt还有一个**错误**：二进制指数退避算法中，应该是$2^m - 1$。
![[Pasted image 20231016084359.png]]

这个式子的推导超出了本书范围，因而也只是一个近似式，但基本符合直觉：
- $t_{prop}$ 变为0时，传输延时为0，那么就不会发生冲突
- $t_{trans}$变为无穷时，发送方发送帧将一直占用信道，因而效率为1。
![[Pasted image 20231016085906.png]]

## 随机存取MAC协议：CSMA/CA（冲突避免）
特点：
- 主要用于无线局域网
- 主要采用冲突避免

无线网络中，信号强度随着传输距离不断减小，也就没办法像CSMA/CD中通过侦听信号强度来判断是否冲突。因而无线网络中只能采取冲突避免的策略。

无线局域网的特点：即使没有冲突，也不代表成功发送。该ppt左下图已经表明，A、C没有侦听到冲突，因而进行发送，但他们在B处冲突，导致发送失败。

因而可以总结无线局域网中：
- 无法做CD
- 做了CD也没用
![[Pasted image 20231016091843.png]]

由于CSMA/CA没有冲突检测，因而必须引入确认机制，这样才能确保自己发送成功。
对比CSMA/CD，因为冲突检测的存在，只要发送完毕，就可以确认发送成功。

另一方面，由于无线链路不可靠，需要在链路层引入可靠机制。

通过引入ACK机制，事实上就完成了CSMA/CA的实用性。
![[Pasted image 20231016093930.png]]

![[Pasted image 20231016095558.png]]
![[Pasted image 20231016100343.png]]

**信道划分与随机存取MAC协议对比**
![[Pasted image 20231016102226.png]]

## 轮流MAC协议
![[Pasted image 20231016102341.png]]
![[Pasted image 20231016102357.png]]
