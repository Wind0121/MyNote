# 导论
## 网络层服务
- 在发送主机和接收主机对之间传送段（segment）
- 在发送端将段封装到数据报中 
- 在接收端，将段上交给传输层实体 
- 网络层协议存在于每一个主机和路由器 （不包括链路层交换机）
- 路由器检查每一个经过它的IP 数据报的头部（用于选择路径）

## 网络层转发与路由
![[Pasted image 20231002091853.png]]
转发是数据平面的功能，路由是控制平面的功能。

## 数据平面、控制平面
![[Pasted image 20231002092534.png]]
传统方式下路由器只会有转发这一个动作，而在SDN方式下，路由器可以有多个动作，比如阻止、泛洪（向所有出路发送）、修改字段，这样就使得整个网络变得可编程。

**传统方式**
传统方式下数据平面和控制平面都集中在一个路由器中，每一个路由器的路由算法元件在控制平面进行交互计算，从而得出路由表，很显然这是一个分布式的过程。

路由选择算法计算出本地转发表后（将在控制平面一章中讲解），数据平面根据IP数据报头部值和转发表匹配后，转发到对应输出链路。

传统方式是一个僵化的方式，一旦设置就难以改变。

**SDN方式**
网络中存在一个集中的SDN服务器，负责与所有路由器进行交互，集中式算出每个路由器的流表后，发送给每个路由器。

这样所有路由器的行为都是可以改变的，因为只需要在集中服务器上进行修改即可。

## 网络服务模型
网络层提供一种尽力而为的服务。
![[Pasted image 20231002095627.png]]

# 路由器组成
## 路由器结构
![[Pasted image 20231002100040.png]]
实际上在路由器中，输入端口和输出端口是整合在一起的。

## 输入端口
![[Pasted image 20231002101614.png]]

## 匹配方式
![[Pasted image 20231002103904.png]]
因为一个路由器中不可能存储所有IP地址的转发表，因而采用前缀就相当于为一个范围内的IP地址分配转发端口。


## 交换结构
![[Pasted image 20231002104205.png]]

**通过内存交换**
![[Pasted image 20231002104653.png]]
在这种情况下，如果内存带宽为每秒可写进内存或从内存读出最多B个分组，则总的转发吞吐量（分组从输入端口被传送到输出端口的总速率）必然小于B/2。因为一个分组使用了两次总线。

也要注意到不能同时转发两个分组，即使它们有不同的目的端口，因为经过共享系统总线一次仅能执行一个内存读/写。

**通过总线交换**
![[Pasted image 20231002104709.png]]
让输入端口为分组预先计划一个交换机内部标签（首部），指示本地输出端口，使分组在总线上传送和传输到输出端口。该分组能由所有输出端口收到，但只有与该标签匹配的端口才能保存该分组。然后标签在输出端口被去除，因为其仅用于交换机内部来跨越总线。

总线一次只能传输一个分组，因而交换带宽受总线速率限制。

**通过互联网络交换**
![[Pasted image 20231002105213.png]]
当某分组到达端口 A,需要转发到端口 Y时，交换机控制器闭合总线A和Y交叉部位的交叉点，然后端口 A在其总线上发送该分组，该分组仅由总线Y接收。

注意到来自端口 B的一个分组在同一时间能够转发到端口 X，因为A到Y和B到X的分组使用不同的输入和输岀总线。

因而互联网络交换能够并行转发多个分组，是非阻塞式的。

## 输出端口
![[Pasted image 20231002105555.png]]

## 调度机制
定义：选择下一个要通过链路传输的分组
策略：
1. FIFO
2. 优先权调度
3. Round Robin (RR) scheduling
4. Weighted Fair Queuing (WFQ)

# IP协议
## IP数据报格式
![[Pasted image 20231002113913.png]]

