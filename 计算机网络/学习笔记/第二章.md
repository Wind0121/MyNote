- [[#应用层协议原理|应用层协议原理]]
	- [[#应用层协议原理#网络应用体系结构|网络应用体系结构]]
		- [[#网络应用体系结构#客户-服务器模式|客户-服务器模式]]
		- [[#网络应用体系结构#P2P（peer to peer）|P2P（peer to peer）]]
		- [[#网络应用体系结构#C/S与P2P的结合|C/S与P2P的结合]]
	- [[#应用层协议原理#进程通信|进程通信]]
- [[#Web与HTTP|Web与HTTP]]
	- [[#Web与HTTP#一些术语|一些术语]]
	- [[#Web与HTTP#HTTP定义|HTTP定义]]
	- [[#Web与HTTP#HTTP连接|HTTP连接]]
	- [[#Web与HTTP#响应时间模型|响应时间模型]]
	- [[#Web与HTTP#HTTP报文|HTTP报文]]
	- [[#Web与HTTP#cookies|cookies]]
	- [[#Web与HTTP#Web缓存|Web缓存]]
	- [[#Web与HTTP#条件GET|条件GET]]
- [[#电子邮件|电子邮件]]
	- [[#电子邮件#SMTP|SMTP]]
	- [[#电子邮件#客户机获取邮件|客户机获取邮件]]
- [[#DNS|DNS]]
	- [[#DNS#必要性|必要性]]
	- [[#DNS#DNS概况|DNS概况]]
	- [[#DNS#DNS提供的服务|DNS提供的服务]]
	- [[#DNS#工作机理概述|工作机理概述]]
- [[#P2P文件分发|P2P文件分发]]
- [[#TCP socket 编程|TCP socket 编程]]
- [[#UDP Socket 编程|UDP Socket 编程]]
- [[#常见端口号|常见端口号]]

# 应用层协议原理
## 网络应用体系结构
### 客户-服务器模式
- 这种方式可扩展性差，难以进行扩展。
- 同时随着请求人数的增加，效率急剧下降。
- 服务器：固定IP地址和周知的端口
- 客户端：可能是动态IP，向服务器请求资源。无法与其他节点通信。

### P2P（peer to peer）
- 几乎没有一直运行的服务器
- 任意端设备之间都可以通信
- 每一个节点既是客户端又是服务器

### C/S与P2P的结合
![Pasted image 20230908112346.png](Pasted%20image%2020230908112346.png)

## 进程通信
- 进程：在主机上运行的应用程序
- 客户端进程：发起通信的进程
- 服务器进程：等待连接的进程

同一个主机中的进程通过操作系统提供的工具（管道、共享文件...）进行通信。不同主机中的进程通过交换报文进行通信。

![Pasted image 20230908113136.png](Pasted%20image%2020230908113136.png)

**问题1**
很显然，我们需要对进程进行标识，具体需要用到以下三个要素：
- 主机：唯一的32位IP地址
- 所采用的传输协议：TCP/UDP
- 所使用的端口号

**问题2**
层间接口需要携带的信息：
- 要传输的报文（对于本层而言就是SDU）（货物）
- 谁传的：客户端进程标识（发件人）
- 传给谁：服务器端进程标识（收件人）

层间信息的代表：
每次传输数据都需要三样东西过于麻烦，事实上在一段连接中，我们只需要管传货物就行。因而我们要用的就是`socket`。类似于我们操作系统中的文件描述符，socket就是个标识，用于代指通信双方

![Pasted image 20230908151859.png](Pasted%20image%2020230908151859.png)

TCP-socket
TCP-socket携带了四种信息：源IP、源端口号、目标IP、目标端口号，因而我们就只管通信就行。
![Pasted image 20230908145926.png](Pasted%20image%2020230908145926.png)

UDP-socket
UDP服务不需要建立连接，也就是说每次报文传输都是独立的，可能传给不同的分布式进程。因而UDP-socket只包含源IP、源端口号，传输时需要另外提供目标IP、目标端口号，而接收报文时传输层需要向上传输对方IP和端口号。
![Pasted image 20230908151450.png](Pasted%20image%2020230908151450.png)

**问题3**
![Pasted image 20230908152721.png](Pasted%20image%2020230908152721.png)

# Web与HTTP
## 一些术语
Web页面不直接包含对象，而是包含对象的链接**URL**
![[Pasted image 20230909190127.png]]
**URL**作为统一资源定位符，完整格式如上。平时使用的www.baidu.com，省略了协议名、用户（匿名访问）、端口（默认端口）

主机名不是一个物理路径，后边的路径也只是相对路径，因而整体也就是一个虚拟路径。我们需要在网站服务器上进行物理路径与虚拟路径之间的映射
![[Pasted image 20230911104404.png]]

## HTTP定义
**概况**
定义：超文本传输协议。Web的应用层协议。
使用协议：TCP协议，运行在端口号80
模式：C/S模式
特点：无状态的。服务器不维护客户的任何信息。

## HTTP连接
![Pasted image 20230911084341.png](Pasted%20image%2020230911084341.png)
非持久和持久的特性是HTTP/1.0和HTTP/1.1之间的区别，并行和非并行则是另一种特性。
## 响应时间模型
![[Pasted image 20230911085230.png]]

非流水线的持久HTTP就是每个引用对象花费一个RTT，但TCP连接建立的一个RTT是省不了的。流水线的持久HTTP，其实就是并发的执行TCP请求，所以可能出现所有引用对象只花费一个RTT。
![[Pasted image 20230911085719.png]]
注意：流水方式虽然并发执行，但也会共享带宽，这一点需要注意
## HTTP报文
**请求报文**
- HTTP报文都是ASCII，也就都是可阅读的。
- 请求行中包含了请求方法、请求路径、HTTP版本
- Host就是请求的主机
- User-agent是用户代理（暂时还没搞懂有什么用）
- Connection表示是否在请求后关闭，按道理HTTP/1.1默认使用持久连接，也就是不会关闭，但也可以设置成关闭。
- 得有一个额外的换行回车符表示报文结束。

![[Pasted image 20230911091702.png]]
![[Pasted image 20230911111851.png]]
其中cr为回车符，表示回到第一个字符；lf为换行符，表示光标向下移一格。对应到ACSII就是\r\n。sp就是空格。

**提交表单**
- Post方式是在请求报文中添加实体部（Entity Body）
- URL方式是使用GET命令，在请求行中的路径部分添加自己需要的参数等。以下两个链接就是例子。其中URL前缀和表单数据以?进行分隔，表单数据为键值对的形式，数据之间以&分隔。
![[Pasted image 20230911093614.png]]

**方法类型**
- GET：向服务器请求指定URL的对象
- POST：用于向服务器提交表单数据，也可以同时请求一个Web页面
- HEAD：要求服务器在返回响应报文时不包含请求对象->故障跟踪、建立索引
- PUT：将实体主体中的文件上载到URL字段规定的路径（通常是维护网站用的）
- DELETE：删除URL字段规定的文件

**响应报文**
![[Pasted image 20230911100448.png]]

![[Pasted image 20230911112023.png]]
和请求报文的格式基本一样，区别就在状态行中。其中短语就是状态码的解释 

## cookies
cookies用于保持用户与服务器之间的状态，通常有四个组成部分：
1. 在HTTP响应报文中有一个cookie的首部行
2. 在HTTP请求报文含有一个cookie的首部行
3. 在用户端系统中保留有一个cookie文件，由用户的浏览器管理
4. 在Web站点有一个后端数据库，保存对应用户和cookie

![[Pasted image 20230911110436.png]]

通过Cookies，我们就可以记录用户-服务器状态，这样我们就可以在设计应用程序时为每个用户定制操作。例子：淘宝购物车就是这样记录了用户的Cookie，每次登录时都会保存购物车状态。

## Web缓存
通过这张图，我们可以看出代理服务器（proxy server）有点像一个Cache，就是一个取指令和执行指令之间的一个高速缓存。其中取指令就是从源服务器取出内容，执行指令就是客户端请求内容。在这个过程中，代理服务器既是服务器也是客户端。
![[Pasted image 20230911113107.png]]

ustc的ppt中有一个关于Web缓存的题目（同时也是课本中的示例题目），是一个非常好的题目，复习的时候可以去看看。

## 条件GET
这个有点像Web缓存的附属内容。我们将内容放到代理服务器后，可能出现脏数据的情况，也就是代理服务器上的内容不是最新的。

因而客户端向代理服务器发送请求且命中时，实际上代理服务器还是会发送一个条件GET到源服务器中，询问从某个时间后请求内容是否发生了变化（If-modified-since: <\date>）。如果没有发生改变，源服务器会发送**304 Not Modified**的响应报文，且不附带**实体主体**（会占带宽）。否则就会进行更新。

# FTP
![[Pasted image 20231125141118.png]]

# 电子邮件
## 组成
- 用户代理
- 邮件服务器
- 传输协议与拉取协议

## SMTP
![[Pasted image 20231124100505.png]]
- 使用TCP，端口25
- 直接传输: 发送服务器到接收服务器
- 邮件报文必须使用7-bit ASCII表示

![[Pasted image 20231124100552.png]]
![[Pasted image 20231125141915.png]]

## 邮件拉取协议
- POP3协议
- IMAP协议
- HTTP协议

**POP3**
![[Pasted image 20231124100833.png]]

![[Pasted image 20231124100902.png]]

**IMAP**
![[Pasted image 20231124100954.png]]
![[Pasted image 20231125142030.png]]


# DNS
## 必要性
![[Pasted image 20230913093414.png]]

## DNS概况
- 分布式数据库
- 使用UDP协议，在53号端口

## DNS提供的服务
DNS是应用层协议，同时也是网络基础设施，负责将主机名翻译成IP地址，其做法如下：
1. 同一台用户主机上运行着DNS应用的客户端
2. 浏览器从需要访问的URL中抽取岀主机名www.someschool.edu,并将这台主机名传给DNS应用的客户端
3. DNS客户向DNS服务器发送一个包含主机名的请求
4. DNS客户最终会收到一份回答报文，其中含有对应于该主机名的IP地址
5. 一旦浏览器接收到来自DNS的该IP地址，它能够向位于该IP地址80端口的HTTP服务器进程发起一个TCP连接

## 工作机理概述
从用户角度来看，可以把DNS服务作为一个黑盒，他提供了主机名到IP地址的翻译服务。但其实现却是复杂的。

**分布式、层次数据库**
![[Pasted image 20230913094354.png]]
共有三类DNS服务器：
1. 根DNS服务器。提供TLD（顶级域）服务器的IP地址。
2. 顶级域DNS服务器（TLD）。对于每个顶级域(如com、org、net、edu和gov)和所有国家的顶级域(如uk、fr、ca和jp),都有TLD服务器(或服务器集群)。TLD服务器提供了权威DNS服务器的IP地址
3. 权威DNS服务器。在因特网上具有公共可访问主机的每个组织机构都必须提供可访问的DNS服务。

除此以外，还有本地DNS服务器，这就类似Web代理，是一个本地的Cache，负责缓存主机名与IP的DNS记录。

# P2P文件分发
![[Pasted image 20231122145844.png]]

![[Pasted image 20231122145919.png]]

**BitTorrent**
- 洪流(torrent)：参与一个特定文件分发的所有对等方的集合
- 追踪器(tracker)：跟踪正参与在洪流中的对等方
- 文件块(chunk)：256KB

![[Pasted image 20231122150049.png]]


# TCP socket 编程
![[Pasted image 20230912171234.png]]
TCP socket编程是需要进行连接建立的。

服务器端，欢迎socket只负责在特定端口号上聆听连接请求，然后把请求转到新建的连接socket上。

伪代码过程如下：
![[Pasted image 20230912172734.png]]
在这个过程中我们可以使用多进程，即主进程只负责守候在welcomeSocket，有连接请求就fork一个新进程进行处理。这里服务器端虽然都会使用同一个端口进行接收，但由于我们之前提过TCP Socket代表的是一个四元组，因而是可以进行区分的。

# UDP Socket 编程
![[Pasted image 20230912180158.png]]
- 每次发送都要指定目标IP地址和端口号。
- 每次接收除了接收报文外，还要接收发送端的IP地址和端口号。

伪代码过程如下：
![[Pasted image 20230912180308.png]]

# 常见端口号
![[9(}]FD`K2AO}ZVEZ0PHTBB0_tmb.jpg]]