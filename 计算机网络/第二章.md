# 应用层协议原理
## 网络应用体系结构
### 客户-服务器模式
- 这种方式可扩展性差，难以进行扩展。
- 同时随着请求人数的增加，效率急剧下降。
- 服务器：固定IP地址和周知的端口
- 客户端：可能是动态IP，向服务器请求资源。无法与其他节点通信。

### P2P（peer to peer）
- 几乎没有一直运行的服务器
- 任意端设备之间都可以通信
- 每一个节点既是客户端又是服务器

### C/S与P2P的结合
![./assets/Pasted image 20230908112346.png](./assets/Pasted%20image%2020230908112346.png)

## 进程通信
- 进程：在主机上运行的应用程序
- 客户端进程：发起通信的进程
- 服务器进程：等待连接的进程

同一个主机中的进程通过操作系统提供的工具（管道、共享文件...）进行通信。不同主机中的进程通过交换报文进行通信。

![Pasted image 20230908113136.png](./assets/Pasted%20image%2020230908113136.png)

**问题1**
很显然，我们需要对进程进行标识，具体需要用到以下三个要素：
- 主机：唯一的32位IP地址
- 所采用的传输协议：TCP/UDP
- 所使用的端口号

**问题2**
层间接口需要携带的信息：
- 要传输的报文（对于本层而言就是SDU）（货物）
- 谁传的：客户端进程标识（发件人）
- 传给谁：服务器端进程标识（收件人）

层间信息的代表：
每次传输数据都需要三样东西过于麻烦，事实上在一段连接中，我们只需要管传货物就行。因而我们要用的就是`socket`。类似于我们操作系统中的文件描述符，socket就是个标识，用于代指通信双方

![Pasted image 20230908151859.png](./assets/Pasted%20image%2020230908151859.png)

TCP-socket
TCP-socket携带了四种信息：源IP、源端口号、目标IP、目标端口号，因而我们就只管通信就行。
![./assets/Pasted image 20230908145926.png](./assets/Pasted%20image%2020230908145926.png)

UDP-socket
UDP服务不需要建立连接，也就是说每次报文传输都是独立的，可能传给不同的分布式进程。因而UDP-socket只包含源IP、源端口号，传输时需要另外提供目标IP、目标端口号，而接收报文时传输层需要向上传输对方IP和端口号。
![Pasted image 20230908151450.png](./assets/Pasted%20image%2020230908151450.png)

**问题3**
![Pasted image 20230908152721.png](./assets/Pasted%20image%2020230908152721.png)

# Web 与 HTTP
## 一些术语
Web页面不直接包含对象，而是包含对象的链接**URL**
![[Pasted image 20230909190127.png]]
**URL**作为统一资源定位符，完整格式如上。平时使用的www.baidu.com，省略了协议名、用户（匿名访问）、端口（默认端口）

## HTTP
### 概况
定义：超文本传输协议。Web的应用层协议。
使用协议：TCP协议
模式：C/S模式
特点：无状态的。服务器不维护客户的任何信息。

### HTTP连接
![./assets/Pasted image 20230911084341.png](./assets/Pasted%20image%2020230911084341.png)
**响应时间模型**
![[Pasted image 20230911085230.png]]

非流水线的持久HTTP就是每个引用对象花费一个RTT，但TCP连接建立的一个RTT是省不了的。流水线的持久HTTP，其实就是并发的执行TCP请求，所以可能出现所有引用对象只花费一个RTT。
![[Pasted image 20230911085719.png]]

### HTTP报文格式
**请求报文**
- HTTP报文都是ASCII，也就都是可阅读的。
- 请求行中包含了请求方法、请求路径、HTTP版本
- Host就是请求的主机
- User-agent是用户代理（暂时还没搞懂有什么用）
- Connection表示是否在请求后关闭，按道理HTTP/1.1默认使用持久连接，也就是不会关闭，但也可以设置成关闭。
- 得有一个额外的换行回车符表示报文结束。

![[Pasted image 20230911091702.png]]

**提交表单**
- Post方式是在请求报文中添加实体部（Entity Body）
- URL方式是使用GET命令，在请求行中的路径部分添加自己需要的参数等。以下两个链接就是例子。
![[Pasted image 20230911093614.png]]

**方法类型**
- GET：请求内容
- POST：提交内容
- HEAD：要求服务器在响应报文中不包含请求对象->故障跟踪、建立索引
- PUT：将实体主体中的文件上载到URL字段规定的路径（通常是维护网站用的）
- DELETE：删除URL字段规定的文件

**响应报文**
