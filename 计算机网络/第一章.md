- [[#什么是Internet|什么是Internet]]
	- [[#什么是Internet#网络|网络]]
	- [[#什么是Internet#计算机网络|计算机网络]]
	- [[#什么是Internet#服务角度的计算机网络|服务角度的计算机网络]]
- [[#网络边缘|网络边缘]]
- [[#网络核心|网络核心]]
	- [[#网络核心#电路交换（circuit switch）（也叫线路交换）|电路交换（circuit switch）（也叫线路交换）]]
	- [[#网络核心#分组交换（packet switch）|分组交换（packet switch）]]
- [[#接入网与物理媒体|接入网与物理媒体]]
	- [[#接入网与物理媒体#modem拨号|modem拨号]]
	- [[#接入网与物理媒体#DSL/ADSL|DSL/ADSL]]
	- [[#接入网与物理媒体#FTTH|FTTH]]
	- [[#接入网与物理媒体#以太网|以太网]]
	- [[#接入网与物理媒体#无线接入网络|无线接入网络]]
	- [[#接入网与物理媒体#典型的家庭网络|典型的家庭网络]]
	- [[#接入网与物理媒体#物理媒体|物理媒体]]
- [[#Internet结构与ISP|Internet结构与ISP]]
- [[#分组时延、丢失和吞吐量|分组时延、丢失和吞吐量]]
	- [[#分组时延、丢失和吞吐量#处理时延|处理时延]]
	- [[#分组时延、丢失和吞吐量#排队时延|排队时延]]
	- [[#分组时延、丢失和吞吐量#传输时延|传输时延]]
	- [[#分组时延、丢失和吞吐量#传播时延|传播时延]]
	- [[#分组时延、丢失和吞吐量#传输时延与传播时延对比|传输时延与传播时延对比]]
	- [[#分组时延、丢失和吞吐量#排队延时/流量强度|排队延时/流量强度]]
	- [[#分组时延、丢失和吞吐量#吞吐量|吞吐量]]
- [[#协议层次和服务模型|协议层次和服务模型]]
	- [[#协议层次和服务模型#分层的体系结构|分层的体系结构]]
	- [[#协议层次和服务模型#服务|服务]]
	- [[#协议层次和服务模型#服务与协议|服务与协议]]
	- [[#协议层次和服务模型#数据单元|数据单元]]
	- [[#协议层次和服务模型#Internet协议栈|Internet协议栈]]
		- [[#Internet协议栈#应用层|应用层]]
		- [[#Internet协议栈#传输层|传输层]]
		- [[#Internet协议栈#网络层|网络层]]
		- [[#Internet协议栈#链路层|链路层]]
		- [[#Internet协议栈#物理层|物理层]]
	- [[#协议层次和服务模型#封装与解封装|封装与解封装]]

# 什么是Internet
## 网络
网络是一个拓扑的概念，可以把网络理解为就是一个节点和边的集合。

## 计算机网络
计算机网络当然就是网络下的一个子集，包括了节点和边。

节点：所有连接到计算机网络的设备，称为**主机（host）** 或 **端设备（end system）**。可以分为主机节点和数据交换节点（这个就不是主机了，而属于通信链路部分），两者功能不同。

边：就是**通信链路**和**分组交换机**。链路分为接入网链路和主干链路。分组交换机的两个主要类型为路由器和链路层交换机。

传输速率：即**带宽**，比特/秒（bit/s, bps）

因特网服务提供商（ISP）：为端设备提供各种网络接入

协议：不同设备在同一层次需要遵守的规则。即定义了通信实体间交换的报文格式和次序，以及对报文所作的相应动作

互联网：某种程度上互联网就是网络的网络，因为它将各种分隔的网络链接在一起。

## 服务角度的计算机网络
即为应用程序提供服务的基础设施

应用程序即**分布式应用程序**

提供服务即通过网络api（socket interface），请求网络基础设施发送数据

# 网络边缘
![[Pasted image 20230829100952.png]]
网络结构可以理解为**网络边缘-接入网-网络核心**，边缘就是各种主机端设备，核心就是链路+分组交换机，接入网就是主机接入网络核心的access

边缘设备包含了设备的协议栈和运行在协议栈上的应用程序，应用程序才是网络存在的意义，协议栈则是支撑这些应用程序运行的第一步，负责和网络核心进行链接。从应用往下看，都是基础设施，基础设施为分布式应用提供服务。 

接入网就是将边缘设备接到网络核心上。这里涉及到一个边缘路由器，也就是端设备连接到网络核心的第一台路由器。

网络核心的作用就是数据交换，可以理解为就是一个超大的网络交换设备（抽象概念）

> DNS服务器：负责将域名（www.baidu.com）转化为IP地址（32位数字）
> 网关：就是边缘路由器

**服务模式**
![[Pasted image 20230829103512.png]]

**面向连接服务**
先建立连接状态，再进行通信。面向连接和有连接不一样，有连接是链路也需要维护这个连接，而面向连接不需要。由于建立了连接，使用TCP服务，因而通信消息是无丢失、无失序的。这些其实都是TCP负责的东西，可以见下图：
![[Pasted image 20230829105137.png]]

**无连接服务**
实际上就是UDP，UDP有其存在的理由。
![[Pasted image 20230829105801.png]]

# 网络核心
网络核心实际上就是路由器的网状网络。网络核心要解决的问题就是如何将数据传输。

## 电路交换（circuit switch）（也叫线路交换）
独享连接，在端系统间通信会话期间， 预留了端系统间沿路径通信所需要的资源。
1. 建立连接
2. 交换数据
3. 释放连接

电路交换中的复用：
![[Pasted image 20230829113819.png]]

电路交换不适合计算机之间的通信，因为电路交换的建立需要的时间较长，而实际通信的时间没有这么长，同时没有持续的使用该链路，因而造成了资源浪费。
![[Pasted image 20230830105448.png]]
![[Pasted image 20230829120408.png]]

传输速率的计算：
![[Pasted image 20230829114723.png]]

## 分组交换（packet switch）
![[Pasted image 20230830111903.png]]
分组可以实现容灾的功能，比如一个分组发生错误，只需要重新发送这个分组。如果一次性发送全部报文，其中发生了错误，就得全部重新发送。

**工作流程**
1. 长数据切分成小段。在发送端，先把较长的报文（message）划分成较短的、固定长度的数据段（这里还不是分组，仅仅是原始数据）
2. 生成分组。在每个数据段前面添加上首部构成分组（packet）。这个首部包含了目的地址（一般来说就是IP地址）、源地址
3. 发送数据。以“分组”作为数据传输单元，依次把各分组发送到接收端
4. 接收数据。接收端收到分组后剥去首部还原成报文
5. 恢复报文。接收端把收到的数据恢复成为原来的报文

**存储转发传输**
分组交换机在输出该分组前，必须完全接收该分组。即存储—>转发

>郑烇老师：如果不是先存储再转发，就会在传输过程中独享该路径上的所有传输资源。如果是存储转发，那么一个交换机在存储分组的时候，下一条链路是可以被其他主机使用的，这样就实现了共享。
>计算时间的时候，发送和接收只用选一个角度就行。这是一个事务的两个方面，发送的时候就在接收。

存储转发会有排队时延，这样的牺牲换取的是网路的共享

计算题示例：
![[Pasted image 20230830210541.png]]
如果是电路交换，就不需要等待存储的时延，因而整体的时间就是5s。
>小tips：传输速率讲的是发送端到接收端的速率，是不考虑链路长度的，链路长度是用来计算传播时延的（应该）

**转发表与路由选择协议**
每个交换机都保存了一个转发表，可以理解一个map，key就是该分组首部携带的目的地址，value就是下一站（可以是主机也可以是交换机），这样最终就能到达目的地。

那么每个交换机的转发表是如何设置的呢？是手动设置还是自动设置？这些都是路由选择协议需要做的事，并且这个过程就是自动设置的。我们将在**第五章**进行讨论

**排队时延与分组丢失**
在交换机中，对于每个相连的链路，交换机都会准备一个输出队列（输出缓存），用于存放交换机将要发送到该链路的分组。如果分组到达时发现需要发送的链路被占用，那么就需要到对应的输出队列中进行等待，这就会产生**排队时延**。如果输出队列已经满了，这时候就会选择丢弃已经到达的分组或正在排队的分组，称为**丢包**。

分组交换同样存在复用链路
![[Pasted image 20230830212032.png]]

**分组交换 vs 电路交换**
![[Pasted image 20230830212743.png]]
![[Pasted image 20230830212730.png]]
这里用概率的计算可以算出用户活跃概率为0.1的情况下，大于等于10个用户同时活跃的概率是0.0004，也是可以接受的。

>这里为什么等于10也不行呢？后面会介绍对于分组交换而言，这样会导致流量强度为1，从而会使网络挂掉。
>为什么0.0004可以接收？因为交换机还是有输出队列的，因而超出负载时是可以进行等待的。


**分组交换网络**
![[Pasted image 20230831111921.png]]
* 数据报网络：
	* 无连接的
	* 每一个分组都独立路由，因而每个分组可能走的路径不一样。
	* 路由器根据分组首部的目标地址进行路由
	* 整体类似于拿着地址去问路
* 虚电路网络：先建立链接，然后在进行通讯，建立起类似于电路交换的链接。
	* 这个虚电路还没太看懂，之后看gxw会怎么讲。
![[Pasted image 20230831113036.png]]

# 接入网与物理媒体
## modem拨号
利用已有电话线，将上网数据加载到音频信号上，在电话线上传输，在局端将该信号解调，从而实现上网通讯。modem就是这个**拨号调制解调器**。无法实现边上网边打电话。
## DSL/ADSL
也是利用电话线进行上网，不过是继续挖掘已有电话线的带宽资源。既保证语音通信，也保证上行数据传输和下行数据传输。如果上行数据和下行数据划分的带宽不同就是ADSL。这种方式就可以实现边上网边打电话。
## FTTH
光纤到户，通过光调制解调器（光猫）进行光电信号互相转换，即传输的时候用光，需要用的时候就重新转化成电信号。
## 以太网
将设备连接到以太网交换机上（第六章将继续讨论）
![[Pasted image 20230831151635.png]]
## 无线接入网络
WiFi：802.11协议，端设备连入WiFi，WiFi练到边缘路由器之类的。
广度无线接入：由电信运营商提供。
## 典型的家庭网络
电信局送来一个光猫，这个光猫一头连接中心局，另一头供家庭使用，这就是FTTH。然后我们就可以将这个光猫连接到一个WiFi上，现在的WiFi包含了众多功能（防火墙、NAT...），然后就可以开始使用了。
![[Pasted image 20230831151134.png]]

## 物理媒体
1. 双绞铜线。家庭内网络
2. 同轴电缆。常用于电缆电视
3. 光纤。在玻璃光纤中传播光脉冲，一个脉冲就是一个比特

# Internet结构与ISP
![[Pasted image 20230831154929.png]]
![[Pasted image 20230831155113.png]]
![[Pasted image 20230831155133.png]]

# 分组时延、丢失和吞吐量
## 处理时延
检查分组首部和决定将该分组导向何处所需要的时间
## 排队时延
在队列中，当分组在链路上等待传输的时间。一个特定分组的排队时延长度将取决于先期到达的正在排队等待向链路传输的分组数量。
## 传输时延
路由器将所有分组的比特推向链路(即传输，或者说发射)所需要的时间。
## 传播时延
一旦一个比特被推向链路，该比特需要向路由器B传播。从该链路的起点到路由器B传播所需要的时间是传播时延
## 传输时延与传播时延对比
![[Pasted image 20230901110528.png]]

## 排队延时/流量强度
此处La/R中，La代表单位时间到达的比特数，R代表传输速率，La/R就代表单位时间需要传送的比例，很显然这个比例不能大于1。
下面这个图其实也是个没有解决的问题，实际上是一个客观观测的结果。
![[Pasted image 20230901143542.png]]
## 吞吐量
吞吐量：源端和目标端之间的传输速率（数据量/单位时间）
1. 瞬时吞吐量
2. 平均吞吐量

# 协议层次和服务模型
## 分层的体系结构
![[Pasted image 20230902191533.png]]
通过层次拆分整个复杂的网络，每个层次都有自己的功能，会直接使用下层提供的服务，并添加这一层的处理，并向上一层提供接口。

## 服务
服务( Service)：低层实体向上层实体提供它们之间的通信的能力

原语(primitive)：上层使用下层服务的形式，高层使用 低层提供的服务，以及低层向高层提供服务都是通过服务访问原语来进行交互的---形式（类似于各种各样的函数）

服务访问点 SAP (Services Access Point) ：上层使用下层服务通过层间的接口—地点（类似端口）

## 服务与协议
区别
* 服务(Service)：低层实体向上层实体提供它们之间的通信的能力，是通过原语(primitive)来操作的。是垂直的
* 协议(protocol) ：对等层实体(peer entity)之间在相互通信的过程中，需要遵循的规则的集合。是水平的
联系
* 本层协议的实现要靠下层提供的服务来实现
* 本层实体通过协议为上层提供更高级的服务

## 数据单元
![[Pasted image 20230902194547.png]]
这其中最重要的就是SDU，上层将SDU往下传，通过接口需要添加上ICI，但这只是一个辅助信息。下层接收到SDU后，添加上本层的头部信息，从而形成本层的PDU（协议数据单元），这就是本层需要交换的数据单元。

![[Pasted image 20230902194735.png]]
这里老师提到了三种SDU的传递方式，从左到右分别是多对一、一对一、一对多。

## Internet协议栈
### 应用层
* 利用传输层，传输应用层分组，称为**报文（message）**
### 传输层
* 在网络层的基础上，实现端设备上应用进程之间的通信
* 通过TCP，将网络层不可靠的传输变为可靠的传输
* 传输层报文称为**报文段（segment）**
### 网络层
* 将称为 **数据报（datagram）** 的网络层分组，从一台主机移动到另一台主机
* 有连接的分组称为**分组（packet）**
### 链路层
* 将网络层需要传送的数据报在链路层中由一个节点传到下一个节点
* 链路层分组称为**帧（frame）**
### 物理层
* 将该帧中的一个个比特从一个节点移动到下一个节点。
* 借助物理媒体，传送物理信号。

## 封装与解封装
![[Pasted image 20230904094813.png]]
数据在链路中上上下下，不断解封装，识别信息，然后再封装，发送给下一节点。
