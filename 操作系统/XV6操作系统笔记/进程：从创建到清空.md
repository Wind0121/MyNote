# 概述
![[Pasted image 20231228172121.png]]
本节我们讲述进程从创建到执行程序到最后退出并被清空的全流程，其中涉及一些其他部分的函数调用，这里只做功能介绍，而不深入探究。

# procinit
该函数负责在操作系统初始化的过程中对进程池进行初始化，因而会在main函数中进行调用。

该函数功能如下：
- 遍历进程池的所有进程
- 对每一个进程调用`initlock`初始化进程的`lock`
- 为每个进程分配一个物理页，并将其映射到对应进程的内核栈区域
	- 首先通过`KSTACK`找到该进程在内核页表中的映射的虚拟地址
	- 调用`kvmmap`将该虚拟地址映射到分配的物理页
- 每个进程的内核栈区域之间都有一个未被映射的页作为guard page，其在kernel_pagetable中的pte有效位标志无效

# fork
fork是一个系统调用，用于创建一个新的进程，并复制当前进程的所有信息。sh进程负责接收输入命令，如果需要执行程序，sh进程会调用fork新建一个进程，并在该进程中调用exec执行程序，exec系统调用会覆盖当前进程。

