# 文件系统概述
## 文件
定义：
- ⽂件是具有符号名的信息(数据)项的集合
- ⽂件是具有符号名的记录的集合

属性：
- 文件名：每个⽂件有⼀个给定的名字，这个名字是由串描述且由⽂件内容来表示，包括⽂件符号名和内部标识符。
	- ⽤户使⽤⽂件符号名来标记⽂件
	- 系统使⽤内部标志符来标记⽂件
- 文件扩展：标记⽂件的使⽤特征
- 文件属性：⽂件类别、保护级

## 文件系统
- ⽂件系统是操作系统中负责管理和存取⽂件信息的软件机构
- 组成
	- 数据结构
	- 管理程序
- 功能
	- ⽤户视⻆：“按名存取”的功能
	- 系统视⻆
		- 辅存空间管理
		- ⽂件集合管理
		- ⽂件保护

## 文件组织
- 逻辑文件：用户角度看到的文件面貌
- 物理文件：信息在物理存储器上的存储方式
	- 文件系统的重要功能之一就是建立物理文件和逻辑文件之间的映像关系
- 逻辑记录：⽂件中按信息在逻辑上的独⽴含义来划分的信息单位，对⽂件进⾏存取操作的基本单位
- 物理记录：在存储介质上，由连续信息组成的⼀个区域称为磁盘块，也可以叫物理记录

# ⽂件的逻辑结构与存取⽅法
## 文件逻辑结构
- 流式文件
	- 流式⽂件是相关的有序字符的集合，是⽆结构的。(仅仅是⼀堆字节组成的字符的集合)
	- 流式⽂件是按信息的个数或以特殊字符为界进⾏存取的
- 记录式⽂件
	- 记录式⽂件是⼀种有结构的⽂件。这种⽂件在逻辑上总是被看成⼀组连续顺序的记录的集合
- 变⻓记录
	- 每个逻辑记录⼤⼩会变化
- 定⻓记录
	- 每个逻辑记录⼤⼩不变

## 文件存取方法
- 顺序存取
	- 后⼀次存取总是在前⼀次存取的基础上进⾏的。 只有取完第⼀个才能取第⼆个
- 随机存取
	- ⽤户以任意次序请求某个记录。 可以随便取第n个元素

# 文件的物理结构
## 连续文件
- ⼀个⽂件分配在磁盘连续区域的物理块
- ⽂件在⽂件⽬录⾥⾯需要提供⽂件⽂件符号名，存放⽂件的第⼀个磁盘块块号，还有⽂件占据了多少个磁盘块
![[Pasted image 20231130113057.png]]

## 串联文件
- 就是⽂件结构是按顺序串联的块组成的，⽂件的信息存在若⼲个物理块中，每个物理块做末⼀个字作为链接字⽤来指示后续物理块的物理地址
- ⽂件在⽂件⽬录⾥⾯需要提供⽂件⽂件符号名，存放⽂件的第⼀个磁盘块块号，剩下的磁盘块号可以通过每个磁盘块的链接字来指示
- ⽂件分配表FAT
	- 把链接指针按顺序集中存放，构成盘⽂件映射表/⽂件分配表(FAT)，串联⽂件的链接字不在每块⾥⾯，⽽是在⼀个统⼀的表⾥⾯，其中FAT的第n个元素为m代表：第n块磁盘块的下⼀个块是m
	- 整个磁盘设置⼀张FAT表，每个盘块对应⼀个表⽬，存放连接⽂件各物理块的指针
![[Pasted image 20231130113427.png]]

这种链表结构不支持随机存取，只能顺序存取
## 索引文件
- 为每个⽂件建⽴逻辑块号和物理块号的对照表。⽂件由数据⽂件和索引表构成。这种⽂件称为索引⽂件。 可以通过查询索引表找到每个⽂件的第n块逻辑块对应物理块块号
![[Pasted image 20231130114002.png]]
- 直接索引
	- 索引表就是存储数据的物理块块号
![[Pasted image 20231130114014.png]]
- ⼀级间接索引
	- ⽂件⽬录项中有⼀组表项，其内容登记的是第⼀级索引表块的块号。第⼀级索引表块中 的索引表项登记的是⽂件逻辑记录所在的磁盘块号
![[Pasted image 20231130114025.png]]
- ⼆级间接索引
	- ⽂件⽬录项中有⼀组表项，其内容登记的是第⼆级索引表块的块号。第⼆级索引表块中 的索引表项登记的第⼀级索引表块的块号，第⼀级索引表项中登记的是⽂件逻辑记录所 在的磁盘块号
![[Pasted image 20231130114035.png]]

# 文件存储空间的管理
磁盘的空闲块可以按空闲文件目录、空闲块链、位示图的方法来组织

## 空闲文件目录
为所有空闲文件建立一个目录
![[Pasted image 20231130115129.png]]

## 空闲块链
将所有空闲块用链表组织在一起

## 位示图
1表示已分配，0表示未分配
![[Pasted image 20231130115225.png]]

# 文件目录
- ⽂件⽬录是记录⽂件名字，存放地址和其他有关⽂件的说明信息和控制信息的数据结构。⽂件⽬录由⽂件⽬录项组成，⼀个⽂件⽬录项记录了⼀个⽂件的信息
	- ⼀级⽂件⽬录：已建⽴的⽂件名、存放地址和有关的说明信息都放在⼀张表⾥⾯就称为⼀级文件⽬录
	- 多级文件目录：![[Pasted image 20231130115541.png]]


## 文件目录项
- 记录这个⽬录下⾯每⼀个⽂件的信息。所以说⽂件⽬录就是由若⼲个⽂件⽬录项组成的数组组成的。
- 组成
	- ⽂件名
	- 逻辑结构
	- 物理结构

## 文件路径名
- 多级⽬录中，⽂件的路径名是由根⽬录到该⽂件的通路上所有⽬录⽂件符号名和该⽂件的符号名组成的字符串，相互之间⽤分隔符分隔

# 共享与安全
## 存取权限验证
1. 访问控制矩阵：1表示能访问，0表示不能访问
![[Pasted image 20231130115918.png]]
2. 存取控制表：只记录特定的用户对该文件的权限
![[Pasted image 20231130120036.png]]
3. 用户权限表：和存取控制表差不多
4. 口令
5. 密码

## ⽂件路径名加快⽂件查找
- 建立当前⽬录
	- 当前⽬录是当前⽤户正在使⽤的⽂件所在的⽬录
	- 当指定当前⽬录后，⽤户对⽂件的所有访问都是相对于”当前⽬录“进⾏的
- 链接技术
	- ⼀个⽬录中的⼀个表⽬直接指向另⼀个⽬录表⽬对应的物理位置。⼀个表⽬的物理结构项就和另外⼀个表⽬的物理结构项⼀样

# ⽂件操作与⽂件备份
## ⽂件的⼀堆操作
![[Pasted image 20231130120413.png]]

## ⽂件的⼀堆表
- 进程控制块⾥⾯有有打开⽂件表，记录这个进程打开了什么⽂件
- 对于进程的打开的许多⽂件有⼀个读写状态信息表，记录进程读或者写⼀个⽂件写到⽂件的哪⾥了
- 活跃⽂件⽬录表，就是记录所有打开过的⽂件的FCB，读写状态信息表中就指向活跃⽂件⽬录表

## 文件备份
- 周期性转储
	- 过⼀个周期就把存储器所有内容存⼀遍
- 增量性转储
	- 以⽂件为单位，定期转储上次转储后改过的新⽂件