# 设备管理概述
## 设备分类
- 设备是计算机系统中除CPU、主存以外的所有设备，也称外部设备
- 存储设备
- I/O设备
- 通信设备

## 目标
1. 提高设备利用率
2. 方便用户使用

## 设备管理的功能
1. 状态跟踪：设备状态信息保留在设备控制块中
2. 设备分配
	- 静态分配：程序进⼊系统的时候就进⾏分配，退出系统的时候回收全部资源
	- 动态分配：进程提出设备申请的时候进行分配，使⽤完毕⽴即收回
3. 设备控制：每个设备都有I/O指令

## 设备独立性
概念：
- ⽤户在程序中使⽤的设备与实际使⽤的设备⽆关，也就是说在⽤户程序中，只使⽤逻辑设备名
- 逻辑设备名：⽤户⾃⼰指定的设备名，可以更改
- 物理设备名：系统提供的设备的标准名称，是永久的，可以更改的
- 系统可以根据设备的使⽤情况，动态地分配给程序中某类设备中的任⼀⼀台物理设备,程序都可以正确运⾏
- 在输⼊/输出信息的时候，信息可以从不同类型的设备上输⼊输出

实现：
1. 软通道实现设备独立性
2. 通过指派命令实现设备独立性
3. 逻辑设备描述器：
	- 用于描述进程内逻辑设备名和物理设备名的对应关系
	- 内容包括逻辑设备名、物理设备名、设备控制快dcb指针、下一描述器指针
	- ![[Pasted image 20231130092459.png]]

## 设备控制块
设备控制块用于记录设备的硬件特性、连接和使用情况等信息
![[Pasted image 20231130092718.png]]

其中命令转换表记录了一台设备能实施的I/O操作，表中包含了设备特定的I/O例程地址，不具备某一功能时，其例程地址为-1

# 缓冲技术
## 定义
两种不同速度的设备之间传输信息的平滑传输过程

## 为什么要缓冲
- 处理数据流⽣产者与消费者速度差异 
- 协调传输数据⼤⼩不⼀致的设备 
- 应⽤程序拷⻉语义（？）

## 单缓冲操作
- 读设备得数据
	- ⾸先获得⼀个空的缓冲区
	- 设备会把物理记录(数据\[从设备来的])送到缓冲区中
	- ⽤户请求数据时，系统将从缓冲区提取数据并发送到⽤户进程存储区
	- 如果⽤户请求数据缓冲区⼜没有怎么办？等待！
- 写数据到设备
	- ⾸先获得⼀个空的缓冲区 
	- 将⼀个逻辑记录(数据\[从应⽤来的])从进程存储区送到缓冲区中 
	- 如果缓冲区写满了，系统将缓冲区内容作为物理记录写到设备上
	- 缓冲区还是满，进程企图输出信息的时候它需要等待

## 双缓冲操作
- 两个缓冲区
- 数据输⼊
	- 输⼊设备⾸先填满buf1 
	- 进程从buf1提取数据的时候,输⼊设备填满buf2.
	- 当缓冲区⼀个空，⼀个满的时候就可以交换
	- 总的来说，就是进程读取⼀个缓冲区，往另外⼀个缓冲区输⼊数据，如此循环往复
- 数据输出
	- ⾸先进程填满buf1
	- 设备从buf1提取数据时候，进程就往buf2输出数据，当缓冲区⼀个空，⼀个满的时候就交换

# 设备分配
## 分配原则
- 静态分配：在作业载⼊的时候就把所有这个作业需要的资源
- 动态分配：在作业(或进程)运⾏的过程中，需要设备时系统根据某种分配原则分配

## 分配算法
- 先来先服务
- 优先级高者优先

## 分配策略
- 独享分配：分配独享设备，在⼀个作业整个运⾏期间占⽤的设备
- 共享分配：分配多个作业、进程共同使⽤的共享设备
- 虚拟分配
	- 所谓虚拟技术，是在⼀类物理设备上模拟另⼀类物理设备的技术，是将独占设备转化为共享设备的技术
	- 通常把⽤来代替独占型设备的那部分外存空间 (包括有关的控制表格)称为虚拟设备
	- 进程先把元素写⼊位于磁盘中的虚拟设备
	- 然后虚拟设备分配管理器再把磁盘中的虚拟设备数据写⼊物理设备
- SPOOLING(⼀种实例虚拟设备分配策略)
	- 预输⼊：应⽤程序需要数据之前，OS已经把所需要的数据放⼊输⼊井中存放，应⽤程序可以直接从输⼊井获取数据
	- 缓输出：应⽤程序执⾏的时候，将输出数据写⼊输出井中，当应⽤程序执⾏完毕后，OS将输出井的数据输出
	- 利⽤通道和中断技术，在主机控制之下，由通道完成输⼊输出⼯作。系统提供⼀个软件系统 (包括预输⼊程序、缓输出程序、井管理程序、预输⼊表、缓输出表)。它提供输⼊收存和输出发送的功能，使外部设备可以并⾏操作。这⼀软件系统称为SPOOLING系统

# 输入/输出控制
## 输入/输出硬件
1. 端口：一种抽象的软件结构，包含数据结构和I/O缓冲区
2. 总线：连接多个设备，用户交换信息
3. 控制器：用于操作端口、总线或设备

## 输入/输出控制方式
**循环测试I/O方式**
控制寄存器有几个重要的信息位，CPU反复检测控制寄存器完成位，从而判断操作是否完成。

**I/O中断方式**
- 进程等待设备时，将进程挂起，CPU调度其他进程执行
- 设备输入完成时，向CPU发起中断请求，CPU转而执行设备的中断处理程序
- CPU唤醒进程并继续执行

**通道方式**
- 通道可以连接多台外部设备，并控制它们的I/O操作
- 通道接收CPU指令，又独立于CPU工作
- CPU将I/O工作交给通道，通道完成工作后向CPU发中断请求，由CPU做后续处理
![[Pasted image 20231130103242.png]]

**DMA方式**
- 除上述中断功能外，还有一个DMA控制机构
- 允许DMA接管地址线的控制权
- 比通道方式更强大

## 输入/输出子系统

